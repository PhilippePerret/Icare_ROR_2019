<html>

<head>
<title>Icare-ROR-2019</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!-- NOTE: margin property = top-right-bottom-left -->
<style type="text/css">

	body {background-color: #e2e2e2}
    
    p.topLevelItemTitle {
    	margin: 30px 0px 5px 0px;
    	font-family: Times, Times New Roman, Palatino, Cochin, Serif;
    	font-size: 30px;
    	}
    	
    p.folderTitle {
    	margin: 30px 0px 5px 0px;
    	font-family: Times, Times New Roman, Palatino, Cochin, Serif;
    	font-size: 18px;
    	}
    
    p.itemTitle {
    	margin: 30px 0px 5px 0px;
    	font-family: Helvetica, Arial, Sans-Serif;
    	font-size: 12px;
    	font-weight: bold;
    	}
    	
    p.itemText {
    	margin: 0px 0px 10px 0px;
    	font-family: Helvetica, Arial, Sans-Serif;
    	font-size: 12px;
    	}
    	
    p.itemTextStart {
    	margin: 30px 0px 10px 0px;
    	font-family: Helvetica, Arial, Sans-Serif;
    	font-size: 12px;
    	}
    
    .page {border: 1px solid #c0c0c0; background: #fff}
    
    hr {
        border: none;
        height: 1px;
        color: #d4d4d4;
        background-color: #d4d4d4;
      	}
      	
    hr.afterTitle {
    	margin-top: -3px;
    }
      	
    hr.afterText {
    	margin-top: 30px;
    }
      	
    ul {
      	list-style-type: none;
      	padding-left: 30px;
      	}
      	
</style>

</head>

<body>

<table border="0" width="100%" cellspacing="3">
<tr>
<td>

<table class="page" width="100%" cellspacing="10" cellpadding="2">

<!-- Top margin -->
<!-- Not needed, because of the padding above titles. -->
<!--<tr><td height="15px"></td></tr>-->

<tr>

<!-- 42 + 30 of list indent = 72 - one inch. -->
<!-- Actually that ends up too much, so we do 25 + 30 = 55px. -->
<td width="25px">

<td valign="top">

<ul>
<li>
<p class="topLevelItemTitle">Introduction</p>
<p class="itemText">Ce manuel présente l'utilisation du site de l'atelier Icare en version Ruby On Rails mise en place en 2019.</p>
</li>
<li>
<p class="topLevelItemTitle">User</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Possessions</p>
<p class="itemText">Un user peut posséder :</p>
<p class="itemText"> • un seul profil (question : faut-il détacher le profil de l'enregistrement simple ?)</p>
<p class="itemText"> • un ou plusieurs icmodules (modules icariens), actifs ou non</p>
<p class="itemText"> • des messages frigo</p>
<p class="itemText"> • des icetapes (étapes de modules icariens)</p>
<p class="itemText"> • des icdocuments (document de travail propres aux modules)</p>
<p class="itemText"> • des tickets</p>
<p class="itemText"> • des watchers (opération atelier)</p>
<p class="itemText"> • des actualités</p>
<p class="itemText"> • des témoignages</p>
<p class="itemText"> • des questions mini-faq</p>

</li>
<li>
<p class="itemTitle">Propriétés directes</p>
<p class="itemText">J'appelle "propriétés directes" les propriétés qui ne dépendent pas d'autres objets. C'est le cas par exemple de l'adresse email ou du pseudo.</p>
<p class="itemText"></p>
<p class="itemText">id</p>
<p class="itemText">Identifiant absolu de l'utilisateur (icarien-ne).</p>
<p class="itemText">email</p>
<p class="itemText">Son adresse email, validée</p>
<p class="itemText">name</p>
<p class="itemText">Pseudo utilisé sur le site (obligatoire)</p>
<p class="itemText">nom</p>
<p class="itemText">Nom réel de l'icarien (obligatoire)</p>
<p class="itemText">prenom</p>
<p class="itemText">Prénom réel de l'icarien (obligatoire)</p>
<p class="itemText">password_digest</p>
<p class="itemText">Mot de passe encrypté</p>
<p class="itemText">statut</p>
<p class="itemText">Bits des privilèges (cf. Statut)</p>
<p class="itemText">options</p>
<p class="itemText">Options diverses (cf. Options)</p>
<p class="itemText">created_at</p>
<p class="itemText">Date de cr...</p>
</li>
<li>
<p class="itemTitle">Statut</p>
<p class="itemText">Propriété :statut</p>
<p class="itemText"></p>
<p class="itemText">0 Simple inscrit</p>
<p class="itemText">1 Simple icarien</p>
<p class="itemText">2 Rédacteur (de ?)</p>
<p class="itemText">4 Administrateur</p>
<p class="itemText">8 Grand manitou</p>
<p class="itemText"></p>
<p class="itemText">Donc : </p>
<p class="itemText">14 : tous les droits (super administrateur, rédacteur)</p>
<p class="itemText">6  : administration et rédaction (4 + 2)</p>
<p class="itemText"></p>
<p class="itemText">La méthode pour afficher la version humaine du statut est :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> human_privileges(user)</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Note : la méthode `human_statut(user)` concerne le statut de l'icarien pour savoir s'il est en pause, actif, etc.</p>

</li>
<li>
<p class="itemTitle">Options</p>
<p class="itemText">Propriété : options</p>
<p class="itemText">C'est un mot de 16 chiffres où chaque chiffre représente une option.</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> Bit</p>
<p class="itemText">Valeurs possibles</p>
<p class="itemText">0</p>
<p class="itemText">1</p>
<p class="itemText">0: à valider, 1: accepté, 2: actif, 3: en pause, 4: inactif, 9: détruit</p>
<p class="itemText">1</p>
<p class="itemText">2</p>
<p class="itemText">Confirmation du mail </p>
<p class="itemText">1: confirmé, 0: non confirmé</p>
<p class="itemText">2</p>
<p class="itemText">3</p>
<p class="itemText">Redirection après l'identification</p>
<p class="itemText">cf. la méthode `redirection_after_login` du fichier sessions_helper</p>
<p class="itemText">3</p>
<p class="itemText">4</p>
<p class="itemText">Candidature incomplète</p>
<p class="itemText">Ce bit est mis à 1 quand l'user a pu être créé mais que sa candidature est incomplète (manque documents et/ou modules opt...</p>
</li>
<li>
<p class="itemTitle">Helpers</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Féminines</p>
<p class="itemText">Féminisation des textes</p>
<p class="itemText"></p>
<p class="itemText">Pour gérer les féminines, on utilise la méthode String#sexize qui va remplacer tous les templates %{…} se trouvant dans le texte par leur valeur masculine ou féminine.</p>
<p class="itemText"></p>
<p class="itemText">Par exemple : </p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> 'icarien%{ne}'.sexize(user)</p>
<p class="itemText"></p>
<p class="itemText"> # => "icarien" si homme, "icarienne" si femme</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Si user n'est pas fourni, c'est l'utilisateur courant qui est utilisé.</p>
<p class="itemText"></p>
<p class="itemText">Les féminines sont définies dans le fichier feminines.</p>
</li>
</ul>
</ul>
<hr class="afterText"/>

<li>
<p class="topLevelItemTitle">Modules Icariens</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">AbsModules</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un module d'apprentissage absolu sont :</p>
<p class="itemText"></p>
<p class="itemText">has_many :ic_modules</p>
<p class="itemText">has_many :users, through :ic_modules</p>
<p class="itemText"></p>
<p class="itemText">has_many :documents, through: :ic_modules (fonctionne ?)</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">name</p>
<p class="itemText">Nom humain du module</p>
<p class="itemText">P.e. « Structure »</p>
<p class="itemText">dim</p>
<p class="itemText">Diminutif, pour les noms par exemple. </p>
<p class="itemText">p.e. "Stt" pour "Structure"</p>
<p class="itemText">module_id</p>
<p class="itemText">ID du module absolu avant 2016.</p>
<p class="itemText">tarif</p>
<p class="itemText">Tarif en euros du module (mensualité pour les modules à durée indéfinie)</p>
<p class="itemText">nombre_jours</p>
<p class="itemText">Durée en nombre de jour du module. Si nil, c'est un module à durée indéter...</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">IcModules</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un module d'apprentissage d'icarien sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :user</p>
<p class="itemText">belongs_to :abs_module</p>
<p class="itemText">has_many :paiements</p>
<p class="itemText">has_many :pauses</p>
<p class="itemText">has_many :ic_etapes</p>
<p class="itemText"></p>
<p class="itemText">has_many :documents, through: :ic_etapes</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">project_name</p>
<p class="itemText">Nom du projet (son titre) s'il en a un</p>
<p class="itemText">state</p>
<p class="itemText">Etat du module (nouvelle propriété). Cf. State</p>
<p class="itemText">options</p>
<p class="itemText">OBSOLÈTE (cf. le fichier Options)</p>
<p class="itemText">started_at</p>
<p class="itemText">Date de démarrage du module</p>
<p class="itemText">Avant : starting_at</p>
<p class="itemText">ended_at</p>
<p class="itemText"></p>
<p class="itemText">Date de fin du module (réelle, pas une pause)</p>
<p class="itemText">Avant : ending_at</p>
<p class="itemText">next_paiement</p>
<p class="itemText">La d...</p>
</li>
<li>
<p class="itemTitle">State</p>
<p class="itemText"></p>
<p class="itemText">Statut (état) du module (propriété :state)</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Valeurs</p>
<p class="itemText">Description</p>
<p class="itemText">0</p>
<p class="itemText">Module en attente de démarrage</p>
<p class="itemText">1</p>
<p class="itemText">Module d'apprentissage en cours de travail</p>
<p class="itemText">2</p>
<p class="itemText">Module d'apprentissage en pause</p>
<p class="itemText">3</p>
<p class="itemText">Module terminé normalement</p>
<p class="itemText">4</p>
<p class="itemText">Module interrompu/abandonné</p>
<p class="itemText">5</p>
<p class="itemText"></p>
<p class="itemText">6</p>
<p class="itemText"></p>
<p class="itemText">7</p>
<p class="itemText"></p>
<p class="itemText"></p>

</li>
<li>
<p class="itemTitle">Options</p>
<p class="itemText">Options pour l'ic-module.</p>
<p class="itemText"></p>
<p class="itemText">OBSOLÈTE — Mais il faut passer les valeurs du bit 0 dans la propriété :state.</p>
<p class="itemText"></p>
<p class="itemText"> Bit</p>
<p class="itemText">Valeurs possibles</p>
<p class="itemText">0</p>
<p class="itemText">1</p>
<p class="itemText">cf. state</p>
<p class="itemText">1</p>
<p class="itemText">2</p>
<p class="itemText"></p>
<p class="itemText">2</p>
<p class="itemText">3</p>
<p class="itemText"></p>
<p class="itemText">3</p>
<p class="itemText">4</p>
<p class="itemText"></p>
<p class="itemText">4</p>
<p class="itemText">5</p>
<p class="itemText"></p>
<p class="itemText">5</p>
<p class="itemText">6</p>
<p class="itemText"></p>
<p class="itemText">6</p>
<p class="itemText">7</p>
<p class="itemText"></p>
<p class="itemText"></p>

</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">AbsEtapes</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'une étape de module d'apprentissage absolu sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :abs_module</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">numero</p>
<p class="itemText">Numéro de l'étape (de 1 à 999)</p>
<p class="itemText">type</p>
<p class="itemText">(nouvelle propriété) Type de l'étape. Cf. Type.</p>
<p class="itemText">titre</p>
<p class="itemText">Titre de l'étape</p>
<p class="itemText">objectif</p>
<p class="itemText">L'objectif à atteindre au cours de cette étape</p>
<p class="itemText">travail</p>
<p class="itemText">Définition du travail (HTML). Note : peut être une liste de travaux.</p>
<p class="itemText">methode</p>
<p class="itemText">Éléments de méthode</p>
<p class="itemText">travaux</p>
<p class="itemText">OBSOLÈTE</p>
<p class="itemText">duree</p>
<p class="itemText">Nombre de jours par défaut pour cette étape.</p>
<p class="itemText">duree_max</p>
<p class="itemText">La durée maximum acceptable pour cette étape.</p>
<p class="itemText">liens</p>
<p class="itemText">Li...</p>
</li>
<li>
<p class="itemTitle">Type</p>
<p class="itemText"></p>
<p class="itemText">Types de l'étape absolue (propriété :type)</p>
<p class="itemText"></p>
<p class="itemText">Note : ce sont des bits qui s'additionnent (bit|bit)</p>
<p class="itemText">Valeurs</p>
<p class="itemText">Description</p>
<p class="itemText">0</p>
<p class="itemText">Aucun type</p>
<p class="itemText">1</p>
<p class="itemText">Travail sur la structure</p>
<p class="itemText">2</p>
<p class="itemText">Travail sur les personnages</p>
<p class="itemText">4</p>
<p class="itemText">Travail sur les thèmes</p>
<p class="itemText">8</p>
<p class="itemText">Travail sur les intrigues</p>
<p class="itemText">16</p>
<p class="itemText">Travail sur un document en particulier (synopsis, pitch, etc.)</p>
<p class="itemText">32</p>
<p class="itemText">Travail de recherche d'idées</p>
<p class="itemText">64</p>
<p class="itemText">Travail de réflexion</p>
<p class="itemText">128</p>
<p class="itemText">Travail de rédaction</p>
<p class="itemText">256</p>
<p class="itemText">Travail d'affinement, de finalisation</p>
<p class="itemText"></p>

</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">IcEtapes</p>
<p class="itemText">Les étapes des modules d'icariens</p>
</li>
<hr class="afterText"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'une étape de module d'apprentissage d'icarien sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :ic_module</p>
<p class="itemText">belongs_to :abs_etape</p>
<p class="itemText">belongs_to :user, through :ic_module</p>
<p class="itemText">has_many :documents</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">status</p>
<p class="itemText">Statut de l'étape. Cf. Statuts</p>
<p class="itemText">options</p>
<p class="itemText">Options de l'étape, quelques valeurs utiles, fixes ou mobiles. Cf. Options</p>
<p class="itemText">travail_propre</p>
<p class="itemText">Éventuellement, le travail propre de l'étape, ou un travail supplémentaire pour l'étape.</p>
<p class="itemText">started_at</p>
<p class="itemText">Date de démarrage de l'étape. Elle pourrait être définie lorsque l'user arrive sur son bur...</p>
</li>
<li>
<p class="itemTitle">Statuts</p>
<p class="itemText"></p>
<p class="itemText">Statuts de l'étape (propriété :status)</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Valeurs</p>
<p class="itemText">Description</p>
<p class="itemText">0</p>
<p class="itemText">Jamais affecté</p>
<p class="itemText">1</p>
<p class="itemText">Étape démarrée, l'icarien y travaille (valeur par défaut)</p>
<p class="itemText">2</p>
<p class="itemText">L'icarien a remis son travail, mais il n'est pas encore reçu</p>
<p class="itemText">3</p>
<p class="itemText">Travail téléchargé par Phil</p>
<p class="itemText">4</p>
<p class="itemText">Dépôt des commentaires (mais l'icarien ne les a pas téléchargé)</p>
<p class="itemText">5</p>
<p class="itemText">L'icarien télécharge ses commentaires</p>
<p class="itemText">6</p>
<p class="itemText">Dépôt des documents sur le QDD (donc il faut que l'icarien ait téléchargé ses commentaires)</p>
<p class="itemText">7</p>
<p class="itemText">Définition du partage des documents par l'icarien (fin de cycle)</p>
<p class="itemText"></p>

</li>
<li>
<p class="itemTitle">Options</p>
<p class="itemText">Options pour l'ic-étape.</p>
<p class="itemText"></p>
<p class="itemText"> Bit</p>
<p class="itemText">Valeurs possibles</p>
<p class="itemText">0</p>
<p class="itemText">1</p>
<p class="itemText">Bit d'avertissement d'échéance d'étape dépassée</p>
<p class="itemText">De 0: pas d'avertissement à 9: tous les avertissements ont été donnés, on considère l'icarien comme déserteur.</p>
<p class="itemText">1</p>
<p class="itemText">2</p>
<p class="itemText">Réalité de l'étape</p>
<p class="itemText">1: l'étape est considérée comme "réelle" (*). 0: l'étape n'est pas réelle.</p>
<p class="itemText">(*) Une étape « réelle » sera comptabilisée dans les modules à durée déterminée qui doivent suivre 8 étapes en général.</p>
<p class="itemText">2</p>
<p class="itemText">3</p>
<p class="itemText"></p>
<p class="itemText">3</p>
<p class="itemText">4</p>
<p class="itemText"></p>
<p class="itemText">4</p>
<p class="itemText">5</p>
<p class="itemText"></p>
<p class="itemText">5</p>
<p class="itemText">6</p>
<p class="itemText"></p>
<p class="itemText">6</p>
<p class="itemText">7</p>
<p class="itemText"></p>
<p class="itemText"></p>

</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">Pauses</p>
<p class="itemText">Les pauses des modules d'icarien.</p>
</li>
<hr class="afterText"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un module d'apprentissage d'icarien sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :ic_module</p>
<p class="itemText"></p>
<p class="itemText">started_at</p>
<p class="itemText">La date du début de la pause (ne pas utiliser created_at car la donnée peut être créée plus tard)</p>
<p class="itemText">ended_at</p>
<p class="itemText">Date de la fin de la pause</p>
<p class="itemText">motif</p>
<p class="itemText">Motif de la pause</p>
<p class="itemText"> + les timestamps par défaut, created_at et updated_at</p>
<p class="itemText">     </p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">IcDocuments</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un document de module d'apprentissage d'icarien sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :ic_etape</p>
<p class="itemText">belongs_to :ic_module, through :ic_etape</p>
<p class="itemText">belongs_to :user, through :ic_etape</p>
<p class="itemText"></p>
<p class="itemText">has_many :lectures</p>
<p class="itemText"></p>
<p class="itemText">original_name</p>
<p class="itemText">Le nom original du fichier tel qu'il a été transmis</p>
<p class="itemText">affixe</p>
<p class="itemText">Affixe donné au document</p>
<p class="itemText">expected_comments_at</p>
<p class="itemText">Date espérée de remise des commentaires</p>
<p class="itemText">OBSOLÈTE : c'est l'étape qui porte cette donnée.</p>
<p class="itemText">commented_at</p>
<p class="itemText">Date effective de remise des commentaires</p>
<p class="itemText">note_auteur</p>
<p class="itemText">La note donnée par l'auteur à son...</p>
</li>
<li>
<p class="itemTitle">Options</p>
<p class="itemText">Options pour `original_options` et `comments_options`, les options des deux documents, original et commenté.</p>
<p class="itemText"></p>
<p class="itemText"> Bit</p>
<p class="itemText">Valeurs possibles</p>
<p class="itemText">0</p>
<p class="itemText">1</p>
<p class="itemText">Existence</p>
<p class="itemText">1: Le document existe, 0: le document  n'existe pas</p>
<p class="itemText">1</p>
<p class="itemText">2</p>
<p class="itemText">Partage</p>
<p class="itemText">0: non défini, 1: partagé, 2: non partagé</p>
<p class="itemText">2</p>
<p class="itemText">3</p>
<p class="itemText">Téléchargement (user ou admin)</p>
<p class="itemText">0: non chargé, 1: chargé (par l'admin si original, par l'icarien si comments)</p>
<p class="itemText">3</p>
<p class="itemText">4</p>
<p class="itemText">Présence sur le QDD</p>
<p class="itemText">0: non déposé, 1: déposé sur le QDD (original si original_options, comments si comments_options)</p>
<p class="itemText">4</p>
<p class="itemText">5</p>
<p class="itemText">Définitio...</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">Lectures</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés des lectures d'un document sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :ic_document</p>
<p class="itemText">belongs_to :user, as: lecteur</p>
<p class="itemText">belongs_to :user, through :ic_document, as: auteur</p>
<p class="itemText"></p>
<p class="itemText">comments</p>
<p class="itemText">Commentaire éventuel du lecteur</p>
<p class="itemText">original_cote</p>
<p class="itemText">Cote sur 5 attribuée par le lecteur au document original</p>
<p class="itemText">comments_cote</p>
<p class="itemText">Cote sur 5 du lecteur au document commenté</p>
<p class="itemText"> + les timestamps par défaut, created_at et updated_at</p>
<p class="itemText">     </p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">Paiements</p>
<p class="itemText">Les paiements concernant un module d'icarien.</p>
<p class="itemText"></p>

</li>
<hr class="afterText"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un module d'apprentissage d'icarien sont :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :ic_module</p>
<p class="itemText">belongs_to :user, through :ic_module</p>
<p class="itemText"></p>
<p class="itemText">objet</p>
<p class="itemText">Objet du paiement</p>
<p class="itemText">montant</p>
<p class="itemText">Montant du paiement en euros</p>
<p class="itemText">facture</p>
<p class="itemText">Le texte de la facture complète (HTML)</p>
<p class="itemText">note</p>
<p class="itemText">Une note (de l'admin) sur ce paiement</p>
<p class="itemText"> + les timestamps par défaut, created_at et updated_at</p>
<p class="itemText">     </p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">MiniFaq</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">belongs_to :abs_etape</p>
<p class="itemText">belongs_to :user</p>
<p class="itemText"></p>
<p class="itemText">question</p>
<p class="itemText">La question posée à Phil</p>
<p class="itemText">reponse</p>
<p class="itemText">Montant du paiement en euros</p>
<p class="itemText">state</p>
<p class="itemText">État de la question</p>
<p class="itemText">0: non répondu, 1: répondu sans indice de satisfaction,</p>
<p class="itemText">2: le questionneur est satisfait par la réponse, 3: le questionneur n'est pas satisfait par la question</p>
<p class="itemText">note</p>
<p class="itemText">Une note (de l'admin) sur cette question, peut-être pour indiquer pourquoi la réponse n'est pas satisfaisante ou pour la compléter.</p>
<p class="itemText"> + les timestamps par défaut, created_at et updated_at</p>
<p class="itemText">     </p>
</li>
</ul>
</ul>
<hr class="afterText"/>

<li>
<p class="topLevelItemTitle">Quotidien programmation</p>
<p class="itemText">Opérations de dépôt</p>
<p class="itemText"> $ git add -A  # pour ajouter les nouveaux fichiers</p>
<p class="itemText"> $ git commit -am "Message dépôt"  # pour faire un nouveau dépôt</p>
<p class="itemText"> $ git push  # pour déposer ce dépôt</p>
<p class="itemText"> $ git push heroku master  # pour actualiser ce dépôt sur heroku</p>
<p class="itemText">Ajout d'un nouveau gem</p>
<p class="itemText">Quand on ajoute un nouveau gem, il faut :</p>
<p class="itemText"></p>
<p class="itemText"> $ bundler install --without production </p>
<p class="itemText"></p>
<p class="itemText">(note : le `--without production' n'est utile qu'une fois)</p>
<p class="itemText"></p>
<p class="itemText">Puis exécuter les opérations de dépôt ci-dessus.</p>
</li>
<li>
<p class="topLevelItemTitle">Désignation</p>
<p class="itemText">La méthode `designation_for(<objet>[, <options>])` permet d'obtenir une désignation humaine de l'objet `<objet>` avec les options `<options>`.</p>
<p class="itemText"></p>
<p class="itemText">Exemple :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> = designation_for(icdocument, name: true, with_ids: true)</p>
<p class="itemText"></p>
<p class="itemText">Options</p>
<p class="itemText"></p>
<p class="itemText"> with_ids: true   Ajoute les ids (administration)</p>
<p class="itemText"> with_user: true  On ajoute le nom de l'icarien.</p>
<p class="itemText"> name: true    Utilise le nom (document, étape, module) plutôt que</p>
<p class="itemText">        l'identifiant.</p>
<p class="itemText"></p>
<p class="itemText"> full: true  Toutes les options sont activées, sauf celles précédées de "*"</p>
<p class="itemText"> distance...</p>
</li>
<li>
<p class="topLevelItemTitle">Tickets</p>
<p class="itemText">Description rapide de l'utilisation d'un ticket :</p>
<p class="itemText"></p>
<p class="itemText">Création du ticket, par exemple pour un ticket qui s'appelle 'jouer_le_ticket' (le nom est purement indicatif) :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> ticket = Ticket.new(name: 'jouer-ticket', action: '/user/1', duree: 4)</p>
<p class="itemText"> # Ce ticket aura une durée de vie de 4 jours et rejoindra l'adresse /user/1</p>
<p class="itemText"> # quand il sera invoqué</p>
<p class="itemText"> @ticket = Phil.tickets.create(ticket.hash_to_create)</p>
<p class="itemText"> # Noter que `@ticket` est une instance distincte de `ticket`</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Dans le mail (vue) qui contient le lien po...</p>
</li>
<li>
<p class="topLevelItemTitle">ActionWatchers</p>
<p class="itemText">Watchers</p>
<p class="itemText">Réflexion</p>
<p class="itemText">Adopte-t-on le même fonctionnement que sur l'ancien site ? C'est-à-dire que les actions sont déclenchées par des notifications complexes.</p>
<p class="itemText">À quoi est-ce que ça ressemblerait dans une application Rails ?</p>
<p class="itemText"></p>
<p class="itemText">Il y aurait un model ActionWatcher qui serait en même temps un observateur et une action possible. Il surveille d'un côté et opère de l'autre.</p>
<p class="itemText">Est-ce qu'il faudrait des AbsActionWatcher qui correspondraient aux choses à faire ? Par exemple, quand l'icarien doit procéder à un pa...</p>
</li>
<hr class="afterText"/>
<ul>
<li>
<p class="itemTitle">Propriétés</p>
<p class="itemText">Les propriétés d'un action_watcher :</p>
<p class="itemText"></p>
<p class="itemText">belongs_to :user</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">model</p>
<p class="itemText">Modèle qui sera touché par l'actionwatcher</p>
<p class="itemText">Avant : `objet`.</p>
<p class="itemText">model_id</p>
<p class="itemText">Identifiant de l'instance du modèle.</p>
<p class="itemText">Avant : `objet_id`</p>
<p class="itemText">action_watcher_path</p>
<p class="itemText">Path de l'action watcher, là où se trouve ses fichiers.</p>
<p class="itemText">Avant : `processus`</p>
<p class="itemText">triggered_at</p>
<p class="itemText">Date où le watcher doit être déclenché. Par exemple, pour un paiement, quelques jours avant son échéance.</p>
<p class="itemText">Avant : `trigerred`</p>
<p class="itemText">data</p>
<p class="itemText">Éventuellement les données dont a besoin l'action-watcher. </p>
<p class="itemText">TODO : voir ...</p>
</li>
<li>
<p class="itemTitle">Création</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">De l'action-watcher lui-même</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Introduction</p>
<p class="itemText">Pendant la phase de conception du watcher, on peut utiliser les méthodes suivantes dans la méthode `execute` du watcher pour ne pas tout recommencer à chaque fois :</p>
<p class="itemText"></p>
<p class="itemText"> dont_destroy   Empêche la destruction du watcher</p>
<p class="itemText"> dont_send_mails  Ne procède pas à l'envoi des mails</p>
</li>
<li>
<p class="itemTitle">Création du dossier et contenu</p>
<p class="itemText">Le plus simple est d'utiliser mon générateur rails :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> $ rails g action_watcher <folder>/<nom_du_watcher>[ <options>]</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Cela crée tout ce qu'il faut dans le dossier ./lib/action_watchers/<nom_du_watcher>/</p>
<p class="itemText"></p>
<p class="itemText">Les options peuvent définir les mails à créer dans le dossier. Par défaut, les mails envoyés à la création du watcher ne sont pas copiés. On les ajoute avec :</p>
<p class="itemText"> --mails-before # pour les créer les deux</p>
<p class="itemText"> --mail-admin-before</p>
<p class="itemText"> --mail-user-before</p>
<p class="itemText">Par défaut, les mails envoyés à l'exécution du watc...</p>
</li>
<li>
<p class="itemTitle">Formulaire</p>
<p class="itemText">Pour faire un un formulaire devant jouer l'action-watcher, utiliser :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> = form_for(action_watcher.objet, url: action_watcher.form_url, method: :post) do |f|</p>
<p class="itemText">  ...</p>
<p class="itemText">  .right.vair</p>
<p class="itemText">   = f.submit('Soumettre le formulaire', class: 'btn btn-primary btn-small')</p>
<p class="itemText"></p>

</li>
<li>
<p class="itemTitle">Notification</p>
<p class="itemText">Formulaire type pour une notification qui doit jouer l'action-watcher :</p>
<p class="itemText"></p>
<p class="itemText">= form_for('<prefix>', url: aw.form_url) do</p>
<p class="itemText"> = ... champs</p>
<p class="itemText"> .right.vair</p>
<p class="itemText">  = submit_tag('Soumettre')</p>
</li>
<hr class="afterText"/>
<ul>
<li>
<p class="itemTitle">Type de la rangée</p>
<p class="itemText">La notification a un type qui est renvoyé par la méthode `notification_type` qui doit être définie dans l'action_watcher_helpers.rb du watcher.</p>
<p class="itemText"></p>
<p class="itemText">Ce type permet de définit l'aspect de la notification. Les types possibles sont :</p>
<p class="itemText"></p>
<p class="itemText">simple-notice</p>
<p class="itemText">Une note d'information sans importance</p>
<p class="itemText">action-required</p>
<p class="itemText">Une action requise, mais pas urgente, comme par exemple une attribution de note à un document lu.</p>
<p class="itemText">main-action-required</p>
<p class="itemText">Une action importante requise, comme par exemple le démarrage d'un module d'apprenti...</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">Modification du mail envoyé</p>
<p class="itemText">Le mail envoyé à l'exécution peut être modifié de deux façons. La première consiste à mettre une alternative dans le mail (if… else… end), le second consiste à modifier le nom du mail choisi.</p>
<p class="itemText">Modification par alternative</p>
<p class="itemText">Par exemple dans .../mailto_admin_after.html.erb</p>
<p class="itemText"></p>
<p class="itemText"> <% if cest_ce_cas_la %></p>
<p class="itemText">  ... contenu du mail ...</p>
<p class="itemText"> <% else %></p>
<p class="itemText">  ... contenu alternatif</p>
<p class="itemText"> <% end %></p>
<p class="itemText"></p>
<p class="itemText">Modification du mail utilisé</p>
<p class="itemText">Par défaut, c'est le mail `mailto_<qui>_after.html.erb` qui est utilisé. On peut modifier ce nom en ...</p>
</li>
<li>
<p class="itemTitle">Interruption de l'action-watcher</p>
<p class="itemText">Dans le programme (méthode `execute`), on peut interrompre la procédure avec la tournure :</p>
<p class="itemText"></p>
<p class="itemText"> def execute</p>
<p class="itemText">  ...</p>
<p class="itemText">  interrupt and return</p>
<p class="itemText">  ...</p>
<p class="itemText"> end</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Cela produit l'interruption totale du processus. Les mails `after` ne seront pas envoyés et l'action-watcher ne sera pas détruit. </p>
</li>
<li>
<p class="itemTitle">Messages de fin</p>
<p class="itemText">On définit le message de fin en utilisant l'une de ces deux méthodes :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> self.success_message  = '<le message de succès>'</p>
<p class="itemText"> self.failure_message  = '<le message d'échec>'</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Pour « aglutiner » plusieurs messages, on utilise les méthodes :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> add_success_message(<message ajouté>)  # ou add_success_final</p>
<p class="itemText"> add_failure_message(<problème ajouté> # ou add_failure_final</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Noter qu'il suffit d'utiliser une de ces deux méthodes une seule fois pour que le message de fin soit automatiquement écrit sur la pa...</p>
</li>
<li>
<p class="itemTitle">Redirection après run</p>
<p class="itemText">Pour rediriger l'action après son exécution, on utilise tout simplement la méthode `redirect_to` avec en argument la nouvelle direction.</p>
<p class="itemText"></p>
<p class="itemText">Mais noter que cette méthode est propre au modèle watcher, ça n'est pas le redirect_to des contrôleurs. Cf. action_watcher.</p>
</li>
<li>
<p class="itemTitle">Résultat de l'exécution</p>
<p class="itemText">Quand le watcher n'est pas joué "automatiquement" comme pour exemple pour la création de la candidature, il faut tester son bon déroulement. Pour ça, on utilise la méthode test :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> <action_watcher>.success?</p>
<p class="itemText"> # => true si le watcher a été joué avec succès.</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Donc l'opération complète va être :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> aw = <user>.action_watchers.create(<paramètres>)</p>
<p class="itemText"> [aw =] aw.run_for(<user>, <params>)</p>
<p class="itemText"> if aw.success?</p>
<p class="itemText">  # C'est un succès</p>
<p class="itemText"> else</p>
<p class="itemText">  # Une erreur est survenue</p>
<p class="itemText">  # Elle se trouve dans aw.fatal_error</p>
<p class="itemText"> end</p>
<p class="itemText"></p>
<p class="itemText"></p>

</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">De l'association</p>
<p class="itemText">On crée un action-watcher avec :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> <user>.action_watchers.create(<hash data>)</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Hash data doit impérativement comporter :</p>
<p class="itemText"></p>
<p class="itemText"> :path ou :name ou :action ou :action_watcher_path</p>
<p class="itemText">  Le chemin d'accès au dossier contenant les éléments du watchers, à partir de</p>
<p class="itemText">  ./lib/action_watchers/</p>
<p class="itemText">  Par exemple 'user/traitement_candidature'</p>
<p class="itemText">  Bien sûr, ce path doit renvoyer à un dossier existant.</p>
<p class="itemText"></p>
<p class="itemText"> :model (String) et :model_id (Integer) ou :objet (instance de class :model)</p>
<p class="itemText">  L'objet visé par l'action-watcher, par e...</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="itemTitle">Notes</p>
<p class="itemText">Peut-être mettre les dossiers des actions-watchers dans lib/ et utiliser `require_dependency` pour les utiliser. En fait, il semble que 'require_dependency' recharge vraiment, même la seconde fois.</p>
<p class="itemText">Pour pouvoir utiliser require_dependency, il faut ajouter dans le fichier config/application.rb :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> config.watchable_dirs['lib'] = [:rb]</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Note : en fait, j'ai utilisé simplement `load` et ça fonctionne.</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="topLevelItemTitle">Liens</p>
</li>
<hr class="afterTitle"/>
<ul>
<li>
<p class="itemTitle">Méthode lien_vers</p>
<p class="itemText">La méthode `lien_vers` (en référence à `link_to`) est une méthode pour pouvoir créer un lien vers n'importe quel page en fonction de l'objet fourni en paramètre (contrairement à `link_to` qui attend un titre et une url précise).</p>
<p class="itemText">Par exemple, `lien_vers(user)` va créer un lien vers l'utilisateur `user` en mettant en titre son pseudonyme.</p>
<p class="itemText">On note deux choses avec l'utilisation ci-dessus : par défaut, c'est la visualisation de l'élément qui est demandé, donc généralement la méthode `show`. Ensuite,...</p>
</li>
<li>
<p class="itemTitle">Essayer une URL</p>
<p class="itemText">Pour essayer une url, on peut ajouter le paramètre `urltry` à l'url. Cela ajoute un "essayer l'URL : ...." dans l'entête.</p>
</li>
</ul>
<hr class="afterText"/>

<li>
<p class="topLevelItemTitle">Seed</p>
<p class="itemText">Pour pouvoir essayer des configurations différentes, on peut utiliser des seeds différents.</p>
<p class="itemText"></p>
<p class="itemText">Il suffit de les définir dans `./db/seeds/' avec un nom qui commencer par 'seed_'. Par exemple : `seed_inscription.rb'. C'est alors le seed « inscription » et il suffit de jouer la commande ci-dessous pour l'invoquer :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> $ rails db:reset:inscription</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Noter que pour charger le seed principal il faut jouer :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> $ rails db:reset:main</p>
<p class="itemText"></p>
<p class="itemText"></p>

</li>
<li>
<p class="topLevelItemTitle">Dates et heures</p>
<p class="itemText">Pour voir les formats utilisables avec I18n.localize(<date>, format: :<format>), cf. le fichier general.</p>
<p class="itemText"></p>
<p class="itemText">Possibilité aussi d'utiliser la méthode `human_date_for(<date>, <options>)` ou son alias `designation_for(<date>[, <options>)`.</p>
<p class="itemText">Dans `<options>` on peut définir `:format`. Valeurs principales : `:simple` et `:simple_with_hour`.</p>
<p class="itemText">options[:distance] permet d'ajouter la distance (p.e. " (dans 8 jours)")</p>
</li>
<li>
<p class="topLevelItemTitle">Aide</p>
<p class="itemText">Les fichiers d'aide doivent se définir dans le dossier :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> ./app/views/aide/files</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">On les invoque par :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> aide_{url|path}('<affixe fichier>')</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Par exemple :</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText"> = link_to 'Le partage', aide_url('partage')</p>
<p class="itemText"></p>
<p class="itemText"></p>
<p class="itemText">Ce lien affiche le contenu du fichier `./app/views/aide/files/partage.html.md`</p>
</li>
</ul>

</td>
<td width="55px">
</td>
</tr>

<!-- Bottom margin -->
<tr><td height="15px"></td></tr>

</table>

</td>
</tr>
</table>

</body>
</html>
